# 🚀 宝塔面板快速部署指南

## 📋 部署前准备

### 1. 服务器要求
- **操作系统**: CentOS 7+, Ubuntu 18+, Debian 9+
- **内存**: 至少 2GB RAM
- **磁盘**: 至少 20GB 可用空间
- **宝塔面板**: 7.0+ 版本

### 2. 上传文件到服务器
将以下文件上传到服务器的 `/root` 目录：
- `bt_import_database.sql` (数据库导入文件)
- `application-bt.properties` (应用配置文件)
- `bt_nginx.conf` (Nginx配置模板)
- `bt_deploy.sh` (自动部署脚本)
- `your-app.jar` (你的Spring Boot应用JAR包)

## 🔧 第一步：安装必要软件

### 1.1 登录宝塔面板
访问 `http://你的服务器IP:8888` 登录宝塔面板

### 1.2 安装软件
在 **软件商店** 中安装以下软件：
- ✅ **MySQL 8.0** (或 5.7)
- ✅ **Nginx 1.20**
- ✅ **Java项目一键部署**
- ✅ **phpMyAdmin** (数据库管理)
- ⭕ **Redis** (可选，用于缓存)

### 1.3 配置MySQL
1. 点击 **MySQL** → **设置** → **配置修改**
2. 在配置文件末尾添加：
```ini
[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
default-time-zone = '+08:00'
max_connections = 200
```
3. 点击 **保存** → **重启**

## 📊 第二步：创建数据库

### 2.1 创建数据库
1. 点击 **数据库** → **添加数据库**
2. 填写信息：
   - **数据库名**: `rent_house`
   - **用户名**: `rent_house`
   - **密码**: `Qwesdx1245@`
   - **访问权限**: `本地服务器`
3. 点击 **提交**

### 2.2 导入数据库结构
1. 点击数据库后面的 **管理** 按钮
2. 进入phpMyAdmin
3. 选择 `rent_house` 数据库
4. 点击 **导入** 标签
5. 选择文件 `bt_import_database.sql`
6. 点击 **执行**

## 🌐 第三步：创建网站

### 3.1 添加站点
1. 点击 **网站** → **添加站点**
2. 填写信息：
   - **域名**: 你的域名或服务器IP
   - **根目录**: `/www/wwwroot/rent-house-management`
   - **PHP版本**: `纯静态`
3. 点击 **提交**

## ⚙️ 第四步：部署应用

### 方法一：自动部署（推荐）

1. SSH连接到服务器
2. 执行自动部署脚本：
```bash
cd /root
chmod +x bt_deploy.sh
./bt_deploy.sh
```
3. 按提示输入MySQL密码和数据库密码

### 方法二：手动部署

#### 4.1 上传JAR包
1. 点击网站后面的 **文件** 按钮
2. 上传你的Spring Boot JAR包到网站根目录
3. 重命名为 `app.jar`

#### 4.2 配置应用
1. 上传 `application-bt.properties` 到网站根目录
2. 重命名为 `application-production.properties`
3. 编辑文件，修改数据库密码：
```properties
spring.datasource.password=你的数据库密码
```

#### 4.3 创建启动脚本
在网站根目录创建 `start.sh`：
```bash
#!/bin/bash
cd /www/wwwroot/rent-house-management
nohup java -Xms512m -Xmx1024m -Dspring.profiles.active=production -jar app.jar > logs/app.log 2>&1 &
echo $! > app.pid
```

给脚本执行权限：
```bash
chmod +x start.sh
```

## 🔄 第五步：配置Nginx反向代理

### 5.1 修改网站配置
1. 点击网站后面的 **设置** 按钮
2. 点击 **配置文件** 标签
3. 将 `bt_nginx.conf` 的内容复制到配置文件中
4. 修改 `server_name` 为你的域名或IP
5. 点击 **保存**

### 5.2 重载Nginx
点击 **软件商店** → **Nginx** → **重载配置**

## 🚀 第六步：启动应用

### 6.1 使用Java项目一键部署
1. 点击 **软件商店** → **已安装** → **Java项目一键部署**
2. 点击 **设置**
3. 添加项目：
   - **项目名称**: `rent-house-management`
   - **项目路径**: `/www/wwwroot/rent-house-management`
   - **JAR包路径**: `/www/wwwroot/rent-house-management/app.jar`
   - **启动端口**: `8080`
   - **JVM参数**: `-Xms512m -Xmx1024m -Dspring.profiles.active=production`
4. 点击 **启动**

### 6.2 验证部署
1. 访问 `http://你的域名或IP/actuator/health`
2. 应该返回 `{"status":"UP"}`
3. 访问 `http://你的域名或IP` 查看应用

## 🔒 第七步：安全配置

### 7.1 配置防火墙
1. 点击 **安全** → **防火墙**
2. 开放端口：
   - `80` (HTTP)
   - `443` (HTTPS)
   - `8080` (Spring Boot，仅内网)

### 7.2 配置SSL证书（推荐）
1. 点击网站 **设置** → **SSL**
2. 选择 **Let's Encrypt** 申请免费证书
3. 开启 **强制HTTPS**

## 📊 第八步：监控和维护

### 8.1 设置定时备份
1. 点击 **计划任务** → **添加任务**
2. 任务类型：**备份数据库**
3. 执行周期：**每天 2:00**
4. 备份数据库：`rent_house_management`

### 8.2 查看日志
- 应用日志：`/www/wwwroot/rent-house-management/logs/app.log`
- Nginx日志：网站设置 → 日志

## 🎯 初始账号信息

部署完成后，可以使用以下账号登录：

| 用户名 | 密码 | 角色 |
|--------|------|------|
| `superadmin` | `123456` | 超级管理员 |
| `admin` | `123456` | 管理员 |
| `finance` | `123456` | 财务人员 |
| `service` | `123456` | 客服人员 |

⚠️ **重要**：请立即修改默认密码！

## 🔧 常用管理命令

### 应用管理
```bash
# 启动应用
cd /www/wwwroot/rent-house-management && ./start.sh

# 停止应用
cd /www/wwwroot/rent-house-management && ./stop.sh

# 重启应用
cd /www/wwwroot/rent-house-management && ./restart.sh

# 查看应用日志
tail -f /www/wwwroot/rent-house-management/logs/app.log
```

### 数据库管理
```bash
# 备份数据库
mysqldump -u rent_app -p rent_house_management > backup.sql

# 恢复数据库
mysql -u rent_app -p rent_house_management < backup.sql
```

## 🐛 故障排除

### 常见问题

1. **应用启动失败**
   - 检查Java版本：`java -version`
   - 查看启动日志：`tail -f /www/wwwroot/rent-house-management/logs/app.log`
   - 检查端口占用：`netstat -tlnp | grep 8080`

2. **数据库连接失败**
   - 检查MySQL服务：宝塔面板 → 软件商店 → MySQL → 启动
   - 检查数据库密码是否正确
   - 检查数据库用户权限

3. **网站无法访问**
   - 检查Nginx配置是否正确
   - 检查防火墙设置
   - 检查域名解析

### 获取帮助
- 查看宝塔面板日志
- 检查系统资源使用情况
- 联系技术支持

---

**部署完成！享受你的房屋租赁管理系统吧！** 🎉
