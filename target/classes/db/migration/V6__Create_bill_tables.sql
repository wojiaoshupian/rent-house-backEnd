-- 创建预估收费账单表
CREATE TABLE estimated_bills (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    room_id BIGINT NOT NULL COMMENT '房间ID',
    bill_month VARCHAR(7) NOT NULL COMMENT '账单年月(YYYY-MM)',
    bill_date DATE NOT NULL COMMENT '账单生成日期',
    rent DECIMAL(10,2) COMMENT '房租',
    deposit DECIMAL(10,2) COMMENT '押金',
    electricity_unit_price DECIMAL(8,4) COMMENT '电费单价',
    electricity_usage DECIMAL(10,2) COMMENT '电费用量',
    electricity_amount DECIMAL(10,2) COMMENT '电费金额',
    water_unit_price DECIMAL(8,4) COMMENT '水费单价',
    water_usage DECIMAL(10,2) COMMENT '水费用量',
    water_amount DECIMAL(10,2) COMMENT '水费金额',
    hot_water_unit_price DECIMAL(8,4) COMMENT '热水费单价',
    hot_water_usage DECIMAL(10,2) COMMENT '热水费用量',
    hot_water_amount DECIMAL(10,2) COMMENT '热水费金额',
    other_fees DECIMAL(10,2) COMMENT '其他费用',
    other_fees_description TEXT COMMENT '其他费用说明',
    total_amount DECIMAL(10,2) COMMENT '总金额',
    bill_status ENUM('GENERATED', 'CONFIRMED', 'SENT', 'PAID', 'OVERDUE', 'CANCELLED') DEFAULT 'GENERATED' COMMENT '账单状态',
    notes TEXT COMMENT '备注',
    created_by BIGINT COMMENT '创建人',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_room_id (room_id),
    INDEX idx_bill_month (bill_month),
    INDEX idx_bill_status (bill_status),
    UNIQUE KEY uk_room_bill_month (room_id, bill_month)
) COMMENT='预估收费账单表';

-- 创建实际收费账单表
CREATE TABLE actual_bills (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    estimated_bill_id BIGINT COMMENT '关联的预估账单ID',
    room_id BIGINT NOT NULL COMMENT '房间ID',
    bill_month VARCHAR(7) NOT NULL COMMENT '账单年月(YYYY-MM)',
    bill_date DATE NOT NULL COMMENT '账单生成日期',
    rent DECIMAL(10,2) COMMENT '房租',
    deposit DECIMAL(10,2) COMMENT '押金',
    electricity_unit_price DECIMAL(8,4) COMMENT '电费单价',
    electricity_usage DECIMAL(10,2) COMMENT '电费用量',
    electricity_amount DECIMAL(10,2) COMMENT '电费金额',
    water_unit_price DECIMAL(8,4) COMMENT '水费单价',
    water_usage DECIMAL(10,2) COMMENT '水费用量',
    water_amount DECIMAL(10,2) COMMENT '水费金额',
    hot_water_unit_price DECIMAL(8,4) COMMENT '热水费单价',
    hot_water_usage DECIMAL(10,2) COMMENT '热水费用量',
    hot_water_amount DECIMAL(10,2) COMMENT '热水费金额',
    other_fees DECIMAL(10,2) COMMENT '其他费用',
    other_fees_description TEXT COMMENT '其他费用说明',
    total_amount DECIMAL(10,2) COMMENT '总金额',
    bill_status ENUM('DRAFT', 'CONFIRMED', 'SENT', 'PAID', 'OVERDUE', 'CANCELLED') DEFAULT 'DRAFT' COMMENT '账单状态',
    payment_status ENUM('UNPAID', 'PARTIAL', 'PAID', 'REFUNDED') DEFAULT 'UNPAID' COMMENT '支付状态',
    payment_date DATE COMMENT '支付日期',
    payment_method VARCHAR(50) COMMENT '支付方式',
    notes TEXT COMMENT '备注',
    created_by BIGINT COMMENT '创建人',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_estimated_bill_id (estimated_bill_id),
    INDEX idx_room_id (room_id),
    INDEX idx_bill_month (bill_month),
    INDEX idx_bill_status (bill_status),
    INDEX idx_payment_status (payment_status),
    INDEX idx_payment_date (payment_date),
    UNIQUE KEY uk_room_bill_month (room_id, bill_month)
) COMMENT='实际收费账单表';
